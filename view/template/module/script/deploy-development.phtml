#!/bin/bash

composer update
npm install

database=$(php -r '$global = require_once("config/autoload/global.php"); echo $global["doctrine"***REMOVED***["connection"***REMOVED***["orm_default"***REMOVED***["params"***REMOVED***["dbname"***REMOVED***;')
username=$(php -r '$local = require_once("config/autoload/local.php"); echo $local["doctrine"***REMOVED***["connection"***REMOVED***["orm_default"***REMOVED***["params"***REMOVED***["user"***REMOVED***;')
password=$(php -r '$local = require_once("config/autoload/local.php"); echo $local["doctrine"***REMOVED***["connection"***REMOVED***["orm_default"***REMOVED***["params"***REMOVED***["password"***REMOVED***;')

vendor/bin/database $database $username $password
vendor/bin/merge-migrations
vendor/bin/phinx migrate

vendor/bin/gulp

vendor/bin/virtualhost  $(pwd) <?php echo $this->moduleUrl;?>.gear.dev development

vendor/bin/unload-module BjyAuthorize

php public/index.php gear project setUpAcl --memcached --user --role
php public/index.php gear module dump-autoload <?php echo $this->module.PHP_EOL;?>
php public/index.php gear module load BjyAuthorize --after=ZfcUserDoctrineORM

