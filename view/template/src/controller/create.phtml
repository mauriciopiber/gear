
    public function createAction()
    {
<?php if (is_array($this->speciality) && in_array('upload-image', $this->speciality)) { ?>
        $this->dropUploadImageSession();
<?php };?>

        $this->form    = $this->get<?= $this->data?>Factory();
        $service = $this->get<?= $this->data?>Service();

        $redirectUrl = $this->url()->fromRoute(self::CREATE);
<?php if (is_array($this->speciality) && in_array('upload-image', $this->speciality)) { ?>
        $prg = $this->filePostRedirectGet($this->form, $redirectUrl, true);
<?php } else { ?>
        $prg = $this->prg($redirectUrl, true);
<?php }?>

        if ($prg instanceof Response) {
            return $prg;
        } elseif ($prg !== false) {
            $this->post = $prg;
<?php echo $this->preValidate;?>
            $this->form->setData($this->post);
            if ($this->form->isValid()) {
                $data = $this->form->getData();
                $create = $service->create($data);
                if ($create) {
<?php if (is_array($this->speciality) && in_array('upload-image', $this->speciality)) { ?>
                    $this->dropUploadImageSession();
<?php } ?>
                    $view = $this->redirect()->toRoute(
                        self::EDIT,
                        array('id' => $create->getId<?= $this->data?>(), 'success' => 1)
                    );
                }
<?php if (is_array($this->speciality) && count($this->speciality)>0) { ?>
            } else {
<?php foreach ($this->speciality as $column => $speciality) : ?>
                $this->verifyErrors('<?php echo $this->str('var', $column)?>');
<?php endforeach;?>
            }
<?php } else { ?>
            }
<?php } ?>
        }

<?php if (is_array($this->speciality)) { ?>
<?php foreach ($this->speciality as $column => $speciality) : ?>
<?php if ($speciality == 'upload-image') :?>
        $<?php echo $this->str('var', $column)?> = $this->getTempUpload('<?php echo $this->str('var', $column)?>');

<?php endif;?>
<?php endforeach;?>
<?php } ?>

        return (isset($view)) ? $view : new ViewModel(
            array(
<?php if (is_array($this->speciality)) { ?>
<?php foreach ($this->speciality as $column => $speciality) : ?>
<?php if ($speciality == 'upload-image') :?>
                '<?php echo $this->str('var', $column)?>' => $<?php echo $this->str('var', $column)?>,
<?php endif;?>
<?php endforeach;?>
<?php } ?>
                'form' => $this->form,
            )
        );
    }
