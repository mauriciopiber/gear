<?php
require 'generate-columns-names';


function factoryColumns($columnType) 
{
    $columns = [***REMOVED***;
    switch  ($columnType) {
        case 'Basic':
            $columns = Gear\Integration\Columns\BasicColumnsInterface::COLUMNS;
            break;
        case 'Complete':
            $columns = array_merge(
                Gear\Integration\Columns\TextColumnsInterface::COLUMNS,
                Gear\Integration\Columns\NumericColumnsInterface::COLUMNS,
                Gear\Integration\Columns\DatesColumnsInterface::COLUMNS,
                Gear\Integration\Columns\VarcharColumnsInterface::COLUMNS
            );
            break;
        case 'Varchar':
            $columns = Gear\Integration\Columns\VarcharColumnsInterface::COLUMNS;
            break;
        case 'Dates':
            $columns = Gear\Integration\Columns\DatesColumnsInterface::COLUMNS;
            break;
        case 'Text':
            $columns = Gear\Integration\Columns\TextColumnsInterface::COLUMNS;
            break;                        
        case 'Numeric':
            $columns = Gear\Integration\Columns\NumericColumnsInterface::COLUMNS;
            break;
        default:
            throw new Exception('Type not found: '.$columnType);
            break;                        
    }

    return $columns;    
}

function createColumnSuffix($columnSuffix)
{

    $label = [
        'nullable' => 'nul',
        'unique' => 'uni',
        'upload-image' => 'upl',
        'complete' => 'cmp',
        'basic' => 'bsc',
        'dates' => 'dts',
        'numeric' => 'nmr',
        'varchar' => 'vrc',
        'text' => 'txt',
        'low-strict' => 'lws',
        'strict' => 'str'
    ***REMOVED***;
    
    $text = [***REMOVED***;

    foreach ($columnSuffix as $option) {
        $text[***REMOVED*** = $label[$option***REMOVED***; 
    }

        
    return implode('_', $text);
}

function addSuffixToColumns($columns, $columnSuffix)
{
    if (empty($columnSuffix)) {
        return $columns;
    }
    
    $fixed = [***REMOVED***;
    
    $columnSuffix = createColumnSuffix($columnSuffix);

    foreach ($columns as $name => $column) {
        $newName = $name.'_'.$columnSuffix;
        $fixed[$newName***REMOVED*** = $column;
    }
    
    return $fixed;
}

/**
 * Gearfile
 */
function factoryGearfileColumns($columnType, $columnSuffix = '')
{
    $columns = factoryColumns($columnType);
    $columns = addSuffixToColumns($columns, $columnSuffix);
    $columnsGearfile = extractGearfileColumns($columns);
    return $columnsGearfile;
}

/**
 * Migration
 */
function factoryMigrationColumns($columnType, $columnSuffix = '')
{
    $columns = factoryColumns($columnType);
    $columns = addSuffixToColumns($columns, $columnSuffix);    
    $columnsGearfile = extractMigrationsColumns($columns);
    return $columnsGearfile;
}

/**
 * Fix Gearfile - Gear\Integration\Component\Gearfile
 */ 
function extractGearfileColumns($columns)
{
    $gearfileColumns = [***REMOVED***;
    foreach ($columns as $columnName => $columnOptions) {
        if (isset($columnOptions['speciality'***REMOVED***)) {
            $gearfileColumns[$columnName***REMOVED*** = $columnOptions['speciality'***REMOVED***;
        }
    }
    return $gearfileColumns;
}

/**
 * Fix Migration
 */
function extractMigrationsColumns($columns)
{
    $gearfileColumns = [***REMOVED***;
    foreach ($columns as $columnName => $columnOptions) {
        if (isset($columnOptions['speciality'***REMOVED***)) {
            unset($columnOptions['speciality'***REMOVED***);
        }
        $gearfileColumns[$columnName***REMOVED*** = $columnOptions;
    }
    return $gearfileColumns;
}