#!/usr/bin/env php
<?php


chdir(dirname(__DIR__));

// Decline static file requests back to the PHP built-in webserver
if (php_sapi_name() === 'cli-server') {
    $path = realpath(__DIR__ . parse_url($_SERVER['REQUEST_URI'***REMOVED***, PHP_URL_PATH));
    if (__FILE__ !== $path && is_file($path)) {
        return false;
    }
    unset($path);
}


// Setup autoloading
require __DIR__.'/generate-functions';


function createPrepareController($type, $repeat)
{
    $implements = [***REMOVED***;
    $implements[***REMOVED*** = [
        'name' => '%sImpl%s%s',
        'type' => 'Interface'
    ***REMOVED***;

    $interfaces = generateGearfiles($implements, ['0' => ''***REMOVED***, $type, $repeat, numberMap());


    $invokables = [***REMOVED***;

    $invokables[***REMOVED*** = [
        'name' => '%sExtendable%s%s',
        'type' => $type
    ***REMOVED***;

    $extends = generateGearfiles($invokables, ['invokables', 'factories'***REMOVED***, $type, $repeat, numberMap());


    return array_merge($interfaces, $extends);
}

function createSuite($type, $repeat)
{

    $invokables[***REMOVED*** = [
        'name' => '%s%s%s',
        'type' => $type
    ***REMOVED***;

    $invokables[***REMOVED*** = [
        'name' => '%sNamespace%s%s',
        'type' => $type,
        'namespace' => '%s'
    ***REMOVED***;

    $invokables[***REMOVED*** = [
        'name' => '%sImplements%s%s',
        'implements' => createMultiplesInterfaces($type, 1, numberMap()),
        'type' => $type
    ***REMOVED***;

    $invokables[***REMOVED*** = [
        'name' => '%sImplementsMany%s%s',
        'implements' => createMultiplesInterfaces($type, $repeat, numberMap()),
        'type' => $type
    ***REMOVED***;

    $invokables[***REMOVED*** = [
        'name' => '%sExtends%s%s',
        'extends' => '%s\%sExtendable%s%s',
        'type' => $type
    ***REMOVED***;

    return generateGearfiles($invokables, ['invokables', 'factories'***REMOVED***, $type, $repeat, numberMap());
}

function createDepSuite()
{
    return [***REMOVED***;
}


$src = array_merge(
    [***REMOVED***,
    createPrepareController($type, $repeat, numberMap())
);

$controller = array_merge(
    [***REMOVED***,
    createSuite($type, $repeat, numberMap()),
    createDepSuite()
);

createGearfileComponent('controller', 'controller-%s', $type, ['src' => $src, 'controller' => $controller***REMOVED***);
