#!/usr/bin/env php
<?php


chdir(dirname(__DIR__));

// Decline static file requests back to the PHP built-in webserver
if (php_sapi_name() === 'cli-server') {
    $path = realpath(__DIR__ . parse_url($_SERVER['REQUEST_URI'***REMOVED***, PHP_URL_PATH));
    if (__FILE__ !== $path && is_file($path)) {
        return false;
    }
    unset($path);
}

require 'init_autoloader.php';

use Gear\Integration\Util;
use Gear\Integration\Component;


$string = new GearBase\Util\String\StringService();
$column = new Gear\Integration\Util\Columns\Columns();
$names = new Gear\Integration\Util\ResolveNames\ResolveNames($string);

$location = new Gear\Integration\Util\Location\Location();
$persist = new Gear\Integration\Util\Persist\Persist($location);

$arrayService = new Gear\Util\Vector\ArrayService();
    
$migrationFile = new Gear\Integration\Component\MigrationFile\MigrationFile(
    $persist,
    $string,
    $arrayService    
);

$gearfile = new Gear\Integration\Component\GearFile\GearFile(
    $persist,
    $string
);
        
$testFile = new Gear\Integration\Component\TestFile\TestFile($persist, $string);

$superTestFile = new Gear\Integration\Component\SuperTestFile\SuperTestFile($persist, $string);
 
$mvcGenerator = new Gear\Integration\Suite\Mvc\MvcGenerator\MvcGenerator(
    $gearfile, 
    $testFile, 
    $migrationFile, 
    $names, 
    $column
);

$srcGenerator = new Gear\Integration\Suite\Src\SrcGenerator\SrcGenerator(
    $gearfile, 
    $testFile
);

$controllerGenerator = new Gear\Integration\Suite\Controller\ControllerGenerator\ControllerGenerator(
    $gearfile, 
    $testFile
);

$srcMvcGenerator = new Gear\Integration\Suite\SrcMvc\SrcMvcGenerator\SrcMvcGenerator(
    $gearfile, 
    $testFile, 
    $migrationFile, 
    $names, 
    $column
);

$controllerMvcGenerator = new Gear\Integration\Suite\ControllerMvc\ControllerMvcGenerator\ControllerMvcGenerator(
    $gearfile, 
    $testFile,
    $names, 
    $column
);

$mvcSuite = new Gear\Integration\Suite\Mvc\MvcSuite\MvcSuite($mvcGenerator, $superTestFile);
$srcSuite = new Gear\Integration\Suite\Src\SrcSuite\SrcSuite($srcGenerator, $superTestFile);
$controllerSuite = new Gear\Integration\Suite\Controller\ControllerSuite\ControllerSuite($controllerGenerator, $superTestFile);
$srcMvcSuite = new Gear\Integration\Suite\SrcMvc\SrcMvcSuite\SrcMvcSuite($srcMvcGenerator, $superTestFile);
$controllerMvcSuite = new Gear\Integration\Suite\ControllerMvc\ControllerMvcSuite\ControllerMvcSuite($controllerMvcGenerator, $superTestFile);


$integration = new Gear\Integration\Suite\Integration\Integration($srcSuite, $srcMvcSuite, $controllerSuite, $controllerMvcSuite, $mvcSuite);

$integration->integrate(); 