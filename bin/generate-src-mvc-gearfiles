#!/usr/bin/env php
<?php


chdir(dirname(__DIR__));

// Decline static file requests back to the PHP built-in webserver
if (php_sapi_name() === 'cli-server') {
    $path = realpath(__DIR__ . parse_url($_SERVER['REQUEST_URI'***REMOVED***, PHP_URL_PATH));
    if (__FILE__ !== $path && is_file($path)) {
        return false;
    }
    unset($path);
}

require __DIR__.'/generate-functions';
require __DIR__.'/generate-columns';


function MvcDependency()
{
    return [
        'Entity' => null,
        'Fixture' => ['Entity'***REMOVED***,
        'Repository' => ['Entity'***REMOVED***,
        'Service' => ['Entity', 'Repository'***REMOVED***,
        'Filter' => ['Entity'***REMOVED***,
        'Form' => ['Filter', 'Entity'***REMOVED***,
        'SearchForm' => ['Entity'***REMOVED***,
        'Controller' => ['Entity', 'Fixture', 'Repository', 'Service', 'Filter', 'Form', 'SearchForm'***REMOVED***
    ***REMOVED***;
}

function generateSrcMvc($suiteType, $suiteColumns, $suiteUserTypes, $suiteConstraints, $suiteTables)
{
    
    $string = new GearBase\Util\String\StringService();
    $suiteSupertype = 'src-mvc';
    
    $suiteName = sprintf('%s/src-mvc-%s', $suiteSupertype, $string->str('url', $suiteType));
    
    echo "$suiteName"."\n";
    
    if ($suiteType === 'Entity') {
        createSrcMvcMigration($suiteType, $suiteColumns, $suiteUserTypes, $suiteConstraints, $suiteTables);
    }
    
    createSrcMvcGearfile($suiteColumns, $suiteUserTypes, $suiteConstraints, $suiteTables);
    
    createSrcMvcTestfile($suiteName);
}

function createSrcMvcMigrationFile(Gear\Integration\Suite\SrcMvc\SrcMvcMinorSuite $srcMvcSuite)
{
    return [
    
    ***REMOVED***;

}

function createSrcMvcMigration($type, $columns, $userTypes, $constraints, $tables)
{
    $resolveNames = createResolveNames();
    
    $i = 0;
    
    $migrationsTables = [***REMOVED***;

    
    foreach ($columns as $column) {
        foreach ($userTypes as $usertype) {
            foreach ($constraints as $constraint) {
                foreach ($tables as $table) {
                    $tableName = sprintf(
                        '%s%s',
                        'SrcMvc',
                        implode('', $resolveNames->createTableAliase($column, $usertype, $constraint, $table))
                    );
                    
                    $srcMvcSuite = new Gear\Integration\Suite\SrcMvc\SrcMvcMinorSuite(
                        'src-mvc', 
                        $usertype, 
                        $column, 
                        $constraint, 
                        $table,
                        $type
                    );
                    
                    //$migrationsTables[$srcMvcSuite->getTableName()***REMOVED*** = createSrcMvcMigrationFile($srcMvcSuite);
                }
            }
        }
    }
    
    var_dump($migrationsTables);
    

    //how many tables combinations this will have?
    
    //will use the same library as MVC.

}

function createSrcMvcGearfile()
{

}
function createSrcMvcTestfile($suiteName)
{
    
}

function generateSrcMvcSuite()
{
    $types = ['Service', 'Repository', 'Form', 'Filter', 'SearchForm', 'Entity', 'Fixture'***REMOVED***;
    
    foreach ($types as $type) {
    
        generateSrcMvc(
            $type,
            [
                'complete',
                'basic',
            ***REMOVED***,    
            ['all', 'low-strict', 'strict'***REMOVED***,
            [null, ['unique'***REMOVED***, ['nullable'***REMOVED***, ['unique', 'nullable'***REMOVED******REMOVED***,
            [null, 'upload_image'***REMOVED***        
        );
    }
}


//columns
generateSrcMvcSuite();
