<?php
namespace MyModuleTest\FilterTest;

use GearBaseTest\FilterTest\AbstractFilterTestCase;

/**
 * @group MyModule
 * @group TableFilter
 * @group Filter
 */
class TableFilterTest extends AbstractFilterTestCase
{
    protected $tableFilter;

    public function getTableFilter()
    {
        if (!isset($this->tableFilter)) {
            $this->tableFilter = $this->bootstrap
              ->getServiceLocator()
              ->get('MyModule\Filter\TableFilter');

            $this->tableFilter
              ->setAdapter($this->bootstrap->getServiceLocator()->get('Zend\Db\Adapter\Adapter'));
        }
        return $this->tableFilter;
    }

    /**
     * @group MyModule
     * @group TableFilter
     */
    public function testServiceLocator()
    {
        $serviceLocator = $this->getTableFilter()->getServiceLocator();
        $this->assertInstanceOf('Zend\ServiceManager\ServiceManager', $serviceLocator);
    }

    /**
     * @group MyModule
     * @group TableFilter
     */
    public function testCallUsingServiceLocator()
    {
        $tableFilter = $this->getTableFilter();
        $this->assertInstanceOf('MyModule\Filter\TableFilter', $tableFilter);
    }

    /**
     * @group MyModule
     * @group TableFilter
    */
    public function testGetInputFilter()
    {
        $tableFilter = $this->getTableFilter();
        $className = $tableFilter->getInputFilter();
        $this->assertInstanceOf('MyModule\Filter\TableFilter', $className);
    }
    public function mockUploadImage()
    {
        $maker = new \GearBaseTest\UploadImageMock();
        return $maker->mockUploadFile(\MyModule\Module::getLocation());
    }

    public function validPost()
    {
        return array(
            array(
                array(
                    'idMyController' => '99',
                    'dateColumn' => '2007-03-09',
                    'datePtBrColumn' => '09/03/2007',
                    'datetimeColumn' => '2007-03-09 03:00:39',
                    'datetimePtBrColumn' => '09/03/2007 03:00:39',
                    'timeColumn' => '03:00:39',
                    'decimalColumn' => '99.99',
                    'moneyPtBrColumn' => 'R$ 99,99',
                    'checkboxColumn' => 'Sim',
                    'idForeignKeyColumn' => '9Foreign Key Column',
                    'intColumn' => '99',
                    'htmlColumn' => '99Html Column',
                    'textColumn' => '99Text Column',
                    'tinyintColumn' => 'Sim',
                    'checkboxColumn' => 'Sim',
                    'emailColumn' => 'email.column99@gmail.com',
                    'passwordVerifyColumn' => '99PasswordVerifyColu',
                    'passwordVerifyColumnVerify' => '99PasswordVerifyColu',
                    'telephoneColumn' => '(51) 9999-9999',
                    'uniqueIdColumn' => '99Unique Column',
                    'uploadImageColumn' => array(
                        'error' => 0,
                        'name' => 'uploadImageColumn99insert.gif',
                        'tmp_name' => $this->mockUploadImage(),
                        'type'      =>  'image/gif',
                        'size'      =>  42,
                    ),
                    'urlColumn' => 'url.column99.com.br',
                    'varcharColumn' => '99Varchar Column',
                ),
            ),
        );
    }

    /**
     * @group MyModule
     * @group TableFilter
     * @dataProvider validPost
     */
    public function testReturnTrueWithValidPost($data)
    {
        $tableFilter = $this->getTableFilter();
        $inputFilter = $tableFilter->getInputFilter();
        $inputFilter->get('uploadImageColumn')->setAutoPrependUploadValidator(false);
        $inputFilter->setData($data);
        $this->assertTrue($inputFilter->isValid());
    }
}
